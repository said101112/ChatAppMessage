

  <!-- Logo avec indicateur de statut -->
  <div class="relative">
    <div class="p-3 bg-green-500 rounded-2xl shadow-sm hover:shadow-md transition-shadow cursor-pointer" >
      <img src="Johanchalibert-Mac-Osx-Yosemite-Messages.512.png" width="36" alt="Icon Chat" class="filter brightness-0 invert" />
    </div>
    <!-- Badge de notification globale -->
    <div *ngIf="globalUnreadCount > 0" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center border-2 border-white font-medium">
      {{globalUnreadCount > 9 ? '9+' : globalUnreadCount}}
    </div>
  </div>
  
  <!-- Avatar utilisateur avec menu déroulant amélioré -->
  <div class="group relative">
    <div class="relative rounded-2xl w-12 h-12 flex items-center justify-center bg-white border border-gray-300 hover:bg-gray-50 transition-colors cursor-pointer shadow-sm">
      <img src="profil-de-lutilisateur.png" width="24" alt="Avatar Profil" />
      <!-- Indicateur de statut utilisateur -->
      <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
    </div>
    
    <!-- Menu déroulant profil amélioré -->
    <div class="absolute left-full ml-3 top-0 w-56 bg-white rounded-xl shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20">
      <!-- En-tête du profil -->
      <div class="p-4 border-b border-gray-200 bg-gradient-to-r from-green-50 to-white">
        <div class="flex items-center gap-3 mb-2">
          <div class="w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center">
            <img src="profil-de-lutilisateur.png" width="20" alt="Avatar" class="rounded-lg" />
          </div>
          <div class="flex-1 min-w-0">
            <div class="font-semibold text-gray-900 truncate">{{userProfil.firstName +" "+ userProfil.lastName || 'Utilisateur'}}</div>
            <div class="text-xs text-green-600 flex items-center gap-1">
              <span [ngClass]="userOnline.includes(userProfil._id) ? 'bg-green-500' : 'bg-gray-500'" class="w-2 h-2  rounded-full"></span>
              {{userOnline.includes(userProfil._id) ? 'En ligne' : 'Hors Ligne'}}
            </div>
          </div>
        </div>
        <div class="text-sm text-gray-500 truncate">{{userProfil.email || 'user@example.com'}}</div>
        <div class="text-sm text-gray-500 truncate">{{userProfil.phone || 'user@example.com'}}</div>
        <div class="text-sm text-gray-500 truncate">{{userProfil.bio || 'Practice makes you Perfect .' }}</div>
      </div>
      
      <!-- Options du menu -->
      <div class="p-2 space-y-1">
        <button (click)="handleProfil()" class="w-full text-left px-3 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Mon profil
        </button>
        
        <button (click)="openSettings()" class="w-full text-left px-3 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
          Paramètres
        </button>

        <button (click)="toggleTheme()" class="w-full text-left px-3 py-2.5 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          Mode {{isDarkMode ? 'Clair' : 'Sombre'}}
        </button>
        
        <div class="border-t border-gray-200 my-1"></div>
        
        <button (click)="logout()"  class="w-full text-left px-3 py-2.5 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16,17 21,12 16,7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          Déconnexion
        </button>
      </div>
    </div>
  </div>
  
  <!-- Séparateur -->
  <div class="h-px w-8 bg-gray-300"></div>

  <!-- Statut / Stories -->
  <div class="relative group">
    <div (click)="openStatus()" 
         class="cursor-pointer p-3 rounded-2xl bg-white border border-gray-300 hover:bg-gray-50 transition-all duration-300 hover:shadow-md">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.4" d="M2.44922 14.9702C3.51922 18.4102 6.39923 21.0602 9.97923 21.7902" stroke="#2dd760" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M2.05078 10.98C2.56078 5.93 6.82078 2 12.0008 2C17.1808 2 21.4408 5.94 21.9508 10.98" stroke="#2dd760" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M14.0098 21.8C17.5798 21.07 20.4498 18.45 21.5398 15.02" stroke="#2dd760" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Statuts
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>
  
  <!-- Nouvelle conversation -->
  <div class="relative group">
    <div
      (click)="newChat()"
      class="cursor-pointer p-3 rounded-2xl transition-all duration-300 hover:shadow-md"
      [ngClass]="{ 
        'bg-green-500 text-white shadow-lg scale-105': isNewChatActive, 
        'bg-white border border-gray-300 hover:bg-gray-50': !isNewChatActive 
      }"
    >
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22Z" stroke="#49ca81" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <g opacity="0.4"> <path d="M8 12H16" stroke="#49ca81" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 16V8" stroke="#49ca81" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g> </g></svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Nouvelle discussion
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>

  <!-- Nouveau groupe -->
  <div class="relative group">
    <div (click)="createGroup()" 
         class="cursor-pointer p-3 rounded-2xl bg-white border border-gray-300 hover:bg-gray-50 transition-all duration-300 hover:shadow-md">
      <svg width="28" height="28" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 1200 1200"><path fill="#2fc147" d="M596.847 188.488c-103.344 0-187.12 97.81-187.12 218.465c0 83.678 40.296 156.352 99.468 193.047l-68.617 31.801l-182.599 84.688c-17.64 8.821-26.444 23.778-26.444 44.947v201.102c1.451 25.143 16.537 48.577 40.996 48.974h649.62c27.924-2.428 42.05-24.92 42.325-48.974V761.436c0-21.169-8.804-36.126-26.443-44.947l-175.988-84.688l-73.138-34.65c56.744-37.521 95.061-108.624 95.061-190.197c-.001-120.656-83.778-218.466-187.121-218.466zm-301.824 76.824c-44.473 1.689-79.719 20.933-106.497 51.596c-29.62 36.918-44.06 80.75-44.339 124.354c1.819 64.478 30.669 125.518 82.029 157.446L21.163 693.997C7.05 699.289 0 711.636 0 731.041v161.398c1.102 21.405 12.216 39.395 33.055 39.703h136.284V761.436c2.255-45.639 23.687-82.529 62.196-100.531l136.247-64.817c10.584-6.175 20.731-14.568 30.433-25.152c-56.176-86.676-63.977-190.491-27.773-281.801c-23.547-14.411-50.01-23.672-75.419-23.823zm608.586 0c-29.083.609-55.96 11.319-78.039 26.444c35.217 92.137 25.503 196.016-26.482 276.52c11.467 13.23 23.404 23.377 35.753 30.434l130.965 62.195c39.897 21.881 60.47 59.098 60.866 100.532v170.707h140.235c23.063-1.991 32.893-20.387 33.093-39.704V731.042c0-17.641-7.05-29.987-21.163-37.045l-202.431-96.618c52.498-38.708 78.859-96.72 79.369-156.117c-1.396-47.012-15.757-90.664-44.339-124.354c-29.866-32.399-66.91-51.253-107.827-51.596z"/></svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Nouveau groupe
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>
  
  <!-- Ajouter un ami -->
  <div class="relative group">
    <div (click)="toggle()" 
         class="cursor-pointer p-3 rounded-2xl bg-white border border-gray-300 hover:bg-gray-50 transition-all duration-300 hover:shadow-md shadow-sm">
<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path fill="#3cb944" fill-rule="evenodd" d="M18.75 10.75V8h1.5v2.75H23v1.5h-2.75V15h-1.5v-2.75H16v-1.5zm-10.918 1.6C7.096 11.478 6.5 9.85 6.5 8.71V7a4 4 0 0 1 8 0v1.71c0 1.14-.6 2.773-1.332 3.642l-.361.428c-.59.699-.406 1.588.419 1.99l5.66 2.762c.615.3 1.114 1.093 1.114 1.783v.687a1 1 0 0 1-1.001.998H2a1 1 0 0 1-1-.998v-.687c0-.685.498-1.483 1.114-1.784l5.66-2.762c.821-.4 1.012-1.288.42-1.99z"/></svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Ajouter un ami
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>

  <!-- Appels -->
  <div class="relative group">
    <div (click)="openCalls()" 
         class="cursor-pointer p-3 rounded-2xl bg-white border border-gray-300 hover:bg-gray-50 transition-all duration-300 hover:shadow-md">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 1025 1023"><path fill="#3ec154" d="m308 288l-88 87q18 65 95 160.5T487.5 708T649 803l87-87q15-15 53-12.5t76.5 12T929 737q56 27 82 66.5t3 61.5L907 972q-43 44-117 49.5t-160-23T448 908T265 759T115.5 575.5T24.5 393t-23-159.5T51 117L158 10q21-21 55 4.5T286 95q19 27 30 97t-8 96z"/></svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Appels
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>

  <!-- Communautés -->
  <div class="relative group">
    <div (click)="openCommunities()" 
         class="cursor-pointer p-3 rounded-2xl bg-white border border-gray-300 hover:bg-gray-50 transition-all duration-300 hover:shadow-md">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><path fill="#3ec154" d="M8.5 8.5a3.75 3.75 0 1 0 0-7.5a3.75 3.75 0 0 0 0 7.5ZM2 11.982C2 10.887 2.887 10 3.982 10h5.6a4.75 4.75 0 0 0 2.294 6H9.483a2.983 2.983 0 0 0-2.758 1.847c-2.005-.371-3.207-1.372-3.894-2.49C2 14.01 2 12.618 2 12.378v-.395Zm15.75-.232c0 .752-.221 1.452-.602 2.04a7.525 7.525 0 0 0-2.102 1.562a3.75 3.75 0 1 1 2.704-3.602ZM9.482 17h4.383A7.468 7.468 0 0 0 13 20.5c0 1.684.555 3.238 1.492 4.49A13.1 13.1 0 0 1 14 25c-3.106 0-4.8-1.228-5.67-2.642c-.83-1.349-.83-2.74-.83-2.981v-.395C7.5 17.887 8.387 17 9.482 17ZM26 12.377c0 .21 0 1.305-.559 2.48A7.471 7.471 0 0 0 20.5 13c-.692 0-1.362.094-1.998.27a4.78 4.78 0 0 0-.085-3.27h5.6c1.096 0 1.983.887 1.983 1.982v.395ZM23.25 4.75a3.75 3.75 0 1 1-7.5 0a3.75 3.75 0 0 1 7.5 0ZM27 20.5a6.5 6.5 0 1 1-13 0a6.5 6.5 0 0 1 13 0Zm-6-4a.5.5 0 0 0-1 0V20h-3.5a.5.5 0 0 0 0 1H20v3.5a.5.5 0 0 0 1 0V21h3.5a.5.5 0 0 0 0-1H21v-3.5Z"/></svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Communautés
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>

  <!-- Messages importants -->
  <div class="relative group">
    <div (click)="toggleStarred()" 
         class="cursor-pointer p-3 rounded-2xl transition-all duration-300"
         [ngClass]="{
           'bg-yellow-100 border-yellow-300': showStarred,
           'bg-white border border-gray-300 hover:bg-gray-50': !showStarred
         }">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" 
              [attr.stroke]="showStarred ? '#F59E0B' : '#666'" 
              [attr.fill]="showStarred ? '#F59E0B' : 'none'"
              stroke-width="1.5" stroke-linejoin="round"/>
      </svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      {{showStarred ? 'Tous les messages' : 'Messages importants'}}
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>

  <!-- Paramètres en bas -->
  <div class="mt-auto relative group">
    <div (click)="openSettings()" 
         class="cursor-pointer p-3 rounded-2xl bg-white border border-gray-300 hover:bg-gray-50 transition-all duration-300 hover:shadow-md">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
      </svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute left-full ml-3 top-1/2 transform -translate-y-1/2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
      Paramètres
      <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div>
    </div>
  </div>
