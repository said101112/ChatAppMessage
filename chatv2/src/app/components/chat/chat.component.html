<div class="grid grid-cols-[80px_380px_1fr] h-screen overflow-hidden bg-white relative">

  <!-- Modal Ajouter un ami -->
  <ng-container *ngIf="isAdduser">
    <div class="flex items-center justify-center inset-0 bg-black/50 absolute z-50">
      <div class="relative w-[440px] bg-white rounded-2xl p-6 shadow-2xl">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-xl font-semibold text-gray-900">Ajouter un ami</h1>
          <button (click)="isAdduser = false" class="text-gray-400 hover:text-gray-600 p-1 rounded-lg transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <form (ngSubmit)="addamis()" class="space-y-4">
          <input
            type="text"
            name="identifiant"
            [(ngModel)]="data.input"
            placeholder="Username ou Email"
            required
            class="w-full px-4 py-3 bg-gray-100 border-0 rounded-xl outline-none focus:bg-gray-200 transition-colors placeholder-gray-500"
          />
          <div class="flex justify-end gap-3 pt-2">
            <button
              type="button"
              (click)="isAdduser = false"
              class="px-5 py-2.5 text-gray-600 hover:text-gray-800 font-medium transition-colors"
            >
              Annuler
            </button>
            <button
              type="submit"
              class="px-5 py-2.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium"
            >
              Ajouter
            </button>
          </div>
        </form>
      </div>
    </div>
  </ng-container>


  <app-sidebar [userOnline]="userOline" 
    [isActived]="isActived"
    [(isAdduser)]="isAdduser"
    [onToggle]="toggleButton.bind(this)" 
    [onProfil]="handleProfil.bind(this)"
    (userProf)="receiveUser($event)"
     class="flex flex-col items-center py-6 gap-8 border-r border-gray-300 bg-gray-100"></app-sidebar>

  <!-- Liste des conversations -->
   
 <div class="flex flex-col border-r border-gray-300 bg-white">
   <ng-container *ngIf="openProfil ; else noprofil">
     <div class="h-screen overflow-y-auto bg-gray-50">

  <!-- Header -->
  <div class="bg-green-500 text-white px-4 py-6">
    <div class="flex items-center gap-4">
      <button class="p-2" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
      <h1 class="text-xl font-semibold">Profil</h1>
    </div>
  </div>

  <!-- Photo de profil et nom -->
  <div class="bg-white px-6 py-8 text-center border-b border-gray-200">
    <div class="relative inline-block">
      <div class="w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden mx-auto mb-4">
        <img 
          [src]="userData?.avatar || 'profil-de-lutilisateur.png'" 
          width="80" 
          class="rounded-full" 
          alt="Photo de profil" 
          (error)="userData.avatar = 'profil-de-lutilisateur.png'"
        />
      </div>
      <button 
        class="absolute bottom-2 right-2 bg-green-500 text-white p-2 rounded-full shadow-lg hover:bg-green-600 transition-colors"
        (click)="changeAvatar()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
          <circle cx="12" cy="13" r="4"/>
        </svg>
      </button>
    </div>
    <h2 class="text-2xl font-bold text-gray-900 mb-2">
      {{ userProfilParent?.firstName }} {{ userProfilParent?.lastName }}
    </h2>
    <p class="text-gray-600">{{ userProfilParent?.username }}</p>
    <p class="text-sm text-gray-500 mt-1">{{ userProfilParent?.status || 'Disponible' }}</p>
  </div>

  <!-- Section Informations personnelles -->
  <div class="bg-white mt-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Informations personnelles</h3>
    </div>
    
    <!-- Nom d'utilisateur -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-sm text-gray-600">Nom d'utilisateur</p>
        <p class="text-gray-900">{{ userProfilParent?.username }}</p>
      </div>
      <button class="text-green-500 text-sm font-medium" (click)="editField('username')">Modifier</button>
    </div>

    <!-- Nom complet -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-sm text-gray-600">Nom complet</p>
        <p class="text-gray-900">{{ userProfilParent?.firstName }} {{ userProfilParent?.lastName }}</p>
      </div>
      <button class="text-green-500 text-sm font-medium" (click)="editField('name')">Modifier</button>
    </div>

    <!-- Email -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-sm text-gray-600">Email</p>
        <p class="text-gray-900">{{ userProfilParent?.email }}</p>
      </div>
      <button class="text-green-500 text-sm font-medium" (click)="editField('email')">Modifier</button>
    </div>

    <!-- Téléphone -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-sm text-gray-600">Téléphone</p>
        <p class="text-gray-900">{{ userProfilParent?.phone || 'Non renseigné' }}</p>
      </div>
      <button class="text-green-500 text-sm font-medium" (click)="editField('phone')">Modifier</button>
    </div>

    <!-- Bio -->
    <div class="px-6 py-4 border-b border-gray-100">
      <div class="flex justify-between items-start mb-2">
        <p class="text-sm text-gray-600">Bio</p>
        <button class="text-green-500 text-sm font-medium" (click)="editField('bio')">Modifier</button>
      </div>
      <p class="text-gray-900">{{ userProfilParent?.bio || 'Aucune bio pour le moment' }}</p>
    </div>

    <!-- Statut -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-sm text-gray-600">Statut</p>
        <p class="text-gray-900">{{ userProfilParent?.status || 'Disponible' }}</p>
      </div>
      <button class="text-green-500 text-sm font-medium" (click)="editField('status')">Modifier</button>
    </div>

    <!-- Dernière connexion -->
    <div class="px-6 py-4 border-b border-gray-100">
      <div>
        <p class="text-sm text-gray-600">Dernière connexion</p>
        <p class="text-gray-900">{{ getLastSeen(userProfilParent?.lastSeen) }}</p>
      </div>
    </div>
  </div>

  <!-- Section Paramètres du compte -->
  <div class="bg-white mt-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Paramètres du compte</h3>
    </div>
    
    <!-- Langue -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-gray-900">Langue</p>
        <p class="text-sm text-gray-600">{{ getLanguageName(userData?.language) }}</p>
      </div>
      <button (click)="editField('language')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Fuseau horaire -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-gray-900">Fuseau horaire</p>
        <p class="text-sm text-gray-600">{{ userProfilParent?.timezone || 'UTC' }}</p>
      </div>
      <button (click)="editField('timezone')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Rôle -->
    <div class="px-6 py-4 border-b border-gray-100">
      <div>
        <p class="text-gray-900">Rôle</p>
        <p class="text-sm text-gray-600 capitalize">{{ userProfilParent?.role || 'user' }}</p>
      </div>
    </div>
  </div>

  <!-- Section Actions importantes -->
  <div class="bg-white mt-6 mb-8">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Actions</h3>
    </div>
    
    <!-- Changer le mot de passe -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-gray-900">Changer le mot de passe</p>
        <p class="text-sm text-gray-600">Mettre à jour votre mot de passe</p>
      </div>
      <button (click)="changePassword()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Exporter les données -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-gray-900">Exporter mes données</p>
        <p class="text-sm text-gray-600">Télécharger une copie de mes informations</p>
      </div>
      <button (click)="exportData()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Supprimer le compte -->
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
      <div>
        <p class="text-red-600">Supprimer mon compte</p>
        <p class="text-sm text-gray-600">Cette action est irréversible</p>
      </div>
      <button (click)="deleteAccount()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <!-- Déconnexion -->
    <div class="px-6 py-4 flex justify-between items-center">
      <div>
        <p class="text-red-600">Déconnexion</p>
        <p class="text-sm text-gray-600">Se déconnecter de tous les appareils</p>
      </div>
      <button >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Modal de modification -->
  <div *ngIf="showEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl w-full max-w-md">
      <div class="p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Modifier {{ getFieldLabel(editingField) }}</h3>
      </div>
      <div class="p-6">
        <div [ngSwitch]="editingField">
          <!-- Champ texte simple -->
          <input 
            *ngSwitchCase="'username'"
            type="text" 
            [(ngModel)]="editValue"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
            [placeholder]="'Votre ' + getFieldLabel(editingField)"
          />
          
          <!-- Champ email -->
          <input 
            *ngSwitchCase="'email'"
            type="email" 
            [(ngModel)]="editValue"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
            placeholder="Votre email"
          />
          
          <!-- Champ téléphone -->
          <input 
            *ngSwitchCase="'phone'"
            type="tel" 
            [(ngModel)]="editValue"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none"
            placeholder="Votre téléphone"
          />
          
          <!-- Textarea pour bio -->
          <textarea 
            *ngSwitchCase="'bio'"
            [(ngModel)]="editValue"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none resize-none"
            placeholder="Votre bio"
            rows="3"
          ></textarea>
        </div>
      </div>
      <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
        <button 
          class="px-4 py-2 text-gray-600 hover:text-gray-800"
          (click)="cancelEdit()"
        >
          Annuler
        </button>
        <button 
          class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
          (click)="saveEdit()"
        >
          Enregistrer
        </button>
      </div>
    </div>
  </div>
</div>
   </ng-container>
    <!-- En-tête avec recherche -->
   <ng-template #noprofil>
     <div class="sticky top-0 z-10 bg-white pt-6 pb-4 px-4 border-b border-gray-300">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold text-gray-900">Messages</h1>
        <button class="p-2 text-gray-500 hover:text-gray-700 rounded-lg transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
      </div>
      
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192.904 192.904" width="16" class="text-gray-400">
            <path fill="currentColor"
              d="m190.707 180.101-47.078-47.077
                 c11.702-14.072 18.752-32.142 18.752-51.831
                 C162.381 36.423 125.959 0 81.191 0
                 36.422 0 0 36.423 0 81.193
                 c0 44.767 36.422 81.187 81.191 81.187
                 19.688 0 37.759-7.049 51.831-18.751
                 l47.079 47.078a7.474 7.474 0 0 0 5.303 2.197
                 7.498 7.498 0 0 0 5.303-12.803zM15 81.193
                 C15 44.694 44.693 15 81.191 15
                 c36.497 0 66.189 29.694 66.189 66.193
                 0 36.496-29.692 66.187-66.189 66.187
                 C44.693 147.38 15 117.689 15 81.193z"
            />
          </svg>
        </div>
        <input
          type="text"
          placeholder="Rechercher une conversation"
          class="w-full pl-12 pr-4 py-3 bg-gray-100 border-0 rounded-xl outline-none focus:bg-gray-200 transition-colors placeholder-gray-500"
        />
      </div>
    </div>

    <!-- Liste des conversations -->
    <div class="flex-1 overflow-y-auto">
      <div
        *ngFor="let item of amis; let i = index"
        class="group relative flex items-center gap-4 p-4 cursor-pointer border-b border-gray-100 hover:bg-gray-50 transition-colors"
        [ngClass]="{ 'bg-green-50': selectedConversation?._id === item._id }"
      >
        <!-- Clic principal pour ouvrir la conversation -->
        <div class="flex items-center gap-4 flex-1" (click)="openConversation(item)">
          <div class="relative flex-shrink-0">
            <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
              <img src="profil-de-lutilisateur.png" width="28" class="rounded-full" alt="Avatar" />
            </div>
            <span 
              [ngClass]="userOline.includes(item._id) ? 'bg-green-500' : 'bg-gray-400'"
              class="absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white">
            </span>
          </div>
          
          <div class="flex-1 min-w-0">
            <div class="flex justify-between items-center mb-1">
              <div class="font-semibold text-gray-900 truncate">{{ item.username }}</div>
              <div class="text-xs text-gray-500 whitespace-nowrap ml-2">
                {{Lastmessages[item._id]?.createdAt && getHeureMinutes(Lastmessages[item._id].createdAt)}}
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <div class="text-sm text-gray-600 truncate flex items-center">
                <span *ngIf="Lastmessages[item._id]?.senderId === userId" class="text-gray-500 mr-1">Vous: </span>
                {{Lastmessages[item._id]?.text !== null ? Lastmessages[item._id].text : 'Aucun message'}}
              </div>
              
              <div *ngIf="countInseenMsg[item._id] > 0" 
                   class="flex-shrink-0 w-5 h-5 bg-green-500 text-white text-xs rounded-full flex items-center justify-center ml-2">
                {{countInseenMsg[item._id]}}
              </div>
            </div>
          </div>
        </div>

        <!-- Bouton dropdown -->
        <div class="relative">
          <button 
            (click)="toggleConversationMenu(i, $event)"
            class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-200 rounded-lg transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="1"></circle>
              <circle cx="12" cy="5" r="1"></circle>
              <circle cx="12" cy="19" r="1"></circle>
            </svg>
          </button>

          <!-- Dropdown Menu -->
          <div 
            *ngIf="openMenuIndex === i"
            class="absolute right-0 top-full mt-1 w-56 bg-white rounded-lg shadow-xl border border-gray-200 z-20 py-2"
            (click)="$event.stopPropagation()">
            
            <!-- En-tête de la conversation -->
            <div class="px-4 py-3 border-b border-gray-100">
              <div class="font-semibold text-gray-900 truncate">{{ item.username }}</div>
              <div class="text-xs text-gray-500 mt-1">
                {{userOline.includes(item._id) ? 'En ligne' : 'Hors ligne'}}
              </div>
            </div>

            <!-- Options du menu -->
            <div class="py-1">
              <!-- Marquer comme non lu -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 6v6l4 2"></path>
                </svg>
                Marquer comme non lu
              </button>

              <!-- Épingler la conversation -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 17l6-6-6-6v12z"></path>
                  <path d="M6 17l6-6-6-6v12z"></path>
                </svg>
                {{item.pinned ? 'Désépingler' : 'Épingler'}}
              </button>

              <!-- Silencer les notifications -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 6L12 2"></path>
                  <path d="M12 22L12 18"></path>
                  <path d="M16 10L19 7"></path>
                  <path d="M5 7L8 10"></path>
                  <path d="M8 14L5 17"></path>
                  <path d="M19 17L16 14"></path>
                  <circle cx="12" cy="14" r="4"></circle>
                </svg>
                {{item.muted ? 'Activer les notifications' : 'Silencer'}}
              </button>

              <!-- Archiver la conversation -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 16V8.00002C20.9996 7.6493 20.9071 7.30483 20.7315 7.00119C20.556 6.69754 20.3037 6.44539 20 6.27002L13 2.27002C12.696 2.09449 12.3511 2.00208 12 2.00208C11.6489 2.00208 11.304 2.09449 11 2.27002L4 6.27002C3.69626 6.44539 3.44398 6.69754 3.26846 7.00119C3.09294 7.30483 3.00036 7.6493 3 8.00002V16C3.00036 16.3508 3.09294 16.6952 3.26846 16.9989C3.44398 17.3025 3.69626 17.5547 4 17.73L11 21.73C11.304 21.9056 11.6489 21.998 12 21.998C12.3511 21.998 12.696 21.9056 13 21.73L20 17.73C20.3037 17.5547 20.556 17.3025 20.7315 16.9989C20.9071 16.6952 20.9996 16.3508 21 16Z"></path>
                  <path d="M16.5 14.5L12 11.5L7.5 14.5"></path>
                  <path d="M12 21.5V11.5"></path>
                </svg>
                Archiver
              </button>

              <!-- Supprimer la conversation -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h18"></path>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                  <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
                Supprimer
              </button>

              <!-- Signaler la conversation -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 9v2m0 4h.01"></path>
                  <path d="M5 19h14a2 2 0 0 0 1.84-2.75L13.74 4a2 2 0 0 0-3.48 0l-7.1 12.25A2 2 0 0 0 4.89 19"></path>
                </svg>
                Signaler
              </button>

              <!-- Bloquer le contact -->
              <button 
                
                class="w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M4.93 4.93l14.14 14.14"></path>
                </svg>
                Bloquer {{ item.username }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
   </ng-template>
  </div>

  <!-- Zone de conversation -->
<ng-container *ngIf="selectedConversation; else noSelected">
    <div class="flex flex-col h-screen bg-white">
      
      <!-- En-tête de conversation simple -->
      <div class="sticky top-0 z-10 bg-white h-16 border-b border-gray-200 flex items-center justify-between px-6">
        <div class="flex items-center gap-4">
          <div class="relative">
            <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden">
              <img src="profil-de-lutilisateur.png" width="24" class="rounded-full" />
            </div>
            <span [ngClass]="userOline.includes(selectedConversation._id) ? 'bg-green-500' : 'bg-gray-400'" 
                  class="absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white"></span>
          </div>
          <div>
            <div class="font-semibold text-gray-900">
              {{ selectedConversation.username }}
            </div>
            <div [ngClass]="userOline.includes(selectedConversation._id) ? 'text-green-600' : 'text-gray-500'" 
                 class="text-xs flex items-center gap-1">
              <span class="w-2 h-2 rounded-full" 
                    [ngClass]="userOline.includes(selectedConversation._id) ? 'bg-green-500' : 'bg-gray-400'"></span>
             
  {{ userOline.includes(selectedConversation._id)
      ? 'En ligne'
      : 'Dernière connexion à ' + getHeureMinutes(selectedConversation?.lastSeen) }}


            </div>
          </div>
        </div>
        
        <div class="flex items-center gap-2">
          <button class="p-2 text-gray-500 hover:text-gray-700 rounded-lg transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
          </button>
          <button class="p-2 text-gray-500 hover:text-gray-700 rounded-lg transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 7l-7 5 7 5V7z"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
          </button>
          <button class="p-2 text-gray-500 hover:text-gray-700 rounded-lg transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="1"/>
              <circle cx="12" cy="5" r="1"/>
              <circle cx="12" cy="19" r="1"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Zone des messages propre -->
      <div class="flex-1 overflow-y-auto px-6 py-4 space-y-3 bg-gray-50">
        <div class="flex justify-center">
          <div class="bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full text-xs text-gray-600 font-medium border border-gray-200/50 shadow-sm">
            Aujourd'hui
          </div>
        </div>
        <div *ngFor="let msg of selectedConversation.conversation">
          
          <!-- Message reçu -->
          <div *ngIf="msg?.senderId === selectedConversation._id" class="flex items-start gap-3 mb-4">
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0">
              <img src="profil-de-lutilisateur.png" width="18" class="rounded-full" alt="Profil" />
            </div>
            <div class="max-w-[70%]">
              <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-gray-100">
                <p class="text-gray-800 text-sm">{{ msg.text }}</p>
              </div>
              <div class="text-xs text-gray-500 mt-1 ml-1">
                {{ getHeureMinutes(msg.createdAt) }}
              </div>
            </div>
          </div>

          <!-- Message envoyé -->
          <div *ngIf="msg?.senderId === userId" class="flex justify-end mb-4">
            <div class="max-w-[70%]">
              <div class="bg-green-500 text-white p-3 rounded-2xl rounded-tr-none shadow-sm">
                <p class="text-sm">{{ msg.text }}</p>
              </div>
              <div class="text-xs text-gray-500 mt-1 mr-1 text-right flex items-center justify-end gap-1">
                <span *ngIf="msg.Seen" class="text-green-300">✓✓</span>
                <span *ngIf="!msg.Seen" class="text-gray-400">✓</span>
                {{ getHeureMinutes(msg.createdAt) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Zone de saisie minimaliste -->
      <div class="sticky bottom-0 bg-white border-t border-gray-200 p-4">
        <div class="flex items-center gap-3 bg-gray-100 rounded-2xl px-4">
          <button class="p-3 text-gray-500 hover:text-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </button>
          
          <input
            type="text"
            placeholder="Tapez un message..."
            class="flex-1 bg-transparent outline-none py-3 text-sm placeholder-gray-500"
            [(ngModel)]="inputMessage"
            (keydown.enter)="sendMessage()"
          />
          
          <button class="p-3 text-gray-500 hover:text-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
              <line x1="9" y1="9" x2="9.01" y2="9"/>
              <line x1="15" y1="9" x2="15.01" y2="9"/>
            </svg>
          </button>
          
          <button
            class="p-3 text-green-500 hover:text-green-600 transition-colors"
            (click)="sendMessage()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- État par défaut (pas de conversation sélectionnée) -->
  <ng-template #noSelected>
    <div class="flex flex-col items-center justify-center h-full bg-gray-100 text-center gap-6 px-8">
     <div class="p-3 bg-green-500 rounded-2xl shadow-sm">
      <img src="Johanchalibert-Mac-Osx-Yosemite-Messages.512.png" width="80" alt="Icon Chat" class="filter brightness-0 invert" />
    </div>
      <h2 class="text-2xl font-bold text-gray-900">Chat Anytime & Anywhere</h2>
      <p class="text-gray-600 max-w-md">
        Sélectionnez une conversation pour commencer à discuter ou créez-en une nouvelle pour vous connecter avec vos amis et collègues.
      </p>
      <button
        (click)="toggleButton()"
        class="mt-4 text-white bg-green-500 hover:bg-green-600 px-6 py-3 text-sm rounded-lg shadow-sm transition-colors font-medium"
      >
        Nouveau message
      </button>
    </div>
  </ng-template>
</div>